<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>1215æŠ€æœ¯æ—¥æŠ¥(çˆ¬è™«+dify)</title>
    <link href="/2025/12/15/1215%E6%8A%80%E6%9C%AF%E6%97%A5%E6%8A%A5/"/>
    <url>/2025/12/15/1215%E6%8A%80%E6%9C%AF%E6%97%A5%E6%8A%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="1-é¢„æœŸç›®æ ‡ï¼šåˆ©ç”¨çˆ¬è™«å¯¹ç‰¹å®šç½‘ç«™æ•°æ®è¿›è¡Œæ‹”å–ä½œä¸ºåŸå§‹æ•°æ®é›†ï¼Œé‡‡ç”¨è¯¥æ•°æ®é›†èåˆæµ‹è¯•aiç”Ÿæˆæ ·ä¾‹ï¼Œå¹¶é€šè¿‡æ ·ä¾‹è¿›è¡Œæé—®ï¼ˆGANï¼‰"><a href="#1-é¢„æœŸç›®æ ‡ï¼šåˆ©ç”¨çˆ¬è™«å¯¹ç‰¹å®šç½‘ç«™æ•°æ®è¿›è¡Œæ‹”å–ä½œä¸ºåŸå§‹æ•°æ®é›†ï¼Œé‡‡ç”¨è¯¥æ•°æ®é›†èåˆæµ‹è¯•aiç”Ÿæˆæ ·ä¾‹ï¼Œå¹¶é€šè¿‡æ ·ä¾‹è¿›è¡Œæé—®ï¼ˆGANï¼‰" class="headerlink" title="1.é¢„æœŸç›®æ ‡ï¼šåˆ©ç”¨çˆ¬è™«å¯¹ç‰¹å®šç½‘ç«™æ•°æ®è¿›è¡Œæ‹”å–ä½œä¸ºåŸå§‹æ•°æ®é›†ï¼Œé‡‡ç”¨è¯¥æ•°æ®é›†èåˆæµ‹è¯•aiç”Ÿæˆæ ·ä¾‹ï¼Œå¹¶é€šè¿‡æ ·ä¾‹è¿›è¡Œæé—®ï¼ˆGANï¼‰"></a>1.é¢„æœŸç›®æ ‡ï¼šåˆ©ç”¨çˆ¬è™«å¯¹ç‰¹å®šç½‘ç«™æ•°æ®è¿›è¡Œæ‹”å–ä½œä¸ºåŸå§‹æ•°æ®é›†ï¼Œé‡‡ç”¨è¯¥æ•°æ®é›†èåˆæµ‹è¯•aiç”Ÿæˆæ ·ä¾‹ï¼Œå¹¶é€šè¿‡æ ·ä¾‹è¿›è¡Œæé—®ï¼ˆGANï¼‰</h1><p>çˆ¬è™«ä»£ç å—å¦‚ä¸‹ï¼šï¼ˆæ ¹æ®å¦ä¸€ç¯‡åšå®¢æ”¹ï¼‰</p><h2 id="å¤´æ–‡ä»¶"><a href="#å¤´æ–‡ä»¶" class="headerlink" title="å¤´æ–‡ä»¶"></a>å¤´æ–‡ä»¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup  <span class="hljs-comment"># ç½‘é¡µè§£æï¼Œè·å–æ•°æ®</span><br><span class="hljs-keyword">import</span> re  <span class="hljs-comment"># æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿›è¡Œæ–‡å­—åŒ¹é…</span><br><span class="hljs-keyword">import</span> urllib.request, urllib.error  <span class="hljs-comment"># åˆ¶å®šURLï¼Œè·å–ç½‘é¡µæ•°æ®</span><br><span class="hljs-keyword">import</span> xlwt  <span class="hljs-comment"># è¿›è¡Œexcelæ“ä½œ</span><br></code></pre></td></tr></table></figure><h2 id="æ­£åˆ™åŒ–ä¿è¯è·å–å¯¹åº”æ ¼å¼å†…å®¹"><a href="#æ­£åˆ™åŒ–ä¿è¯è·å–å¯¹åº”æ ¼å¼å†…å®¹" class="headerlink" title="æ­£åˆ™åŒ–ä¿è¯è·å–å¯¹åº”æ ¼å¼å†…å®¹"></a>æ­£åˆ™åŒ–ä¿è¯è·å–å¯¹åº”æ ¼å¼å†…å®¹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">findLink = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;a href=&quot;(.*?)&quot;&gt;&#x27;</span>)  <span class="hljs-comment"># å½±ç‰‡è¯¦æƒ…é“¾æ¥çš„è§„åˆ™</span><br>findImgSrc = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;img.*?src=&quot;(.*?)&quot;&#x27;</span>, re.S)  <span class="hljs-comment"># ä¿®å¤æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ·»åŠ éè´ªå©ªåŒ¹é…</span><br>findTitle = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;span class=&quot;title&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span>, re.S)  <span class="hljs-comment"># æ·»åŠ éè´ªå©ªåŒ¹é…å’Œre.S</span><br>findRating = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span>)  <span class="hljs-comment"># æ·»åŠ éè´ªå©ªåŒ¹é…</span><br>findJudge = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;span&gt;(\d+)äººè¯„ä»·&lt;/span&gt;&#x27;</span>)<br>findInq = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;span class=&quot;inq&quot;&gt;(.*?)&lt;/span&gt;&#x27;</span>, re.S)  <span class="hljs-comment"># æ·»åŠ éè´ªå©ªåŒ¹é…å’Œre.S</span><br>findBd = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&#x27;&lt;p class=&quot;&quot;&gt;(.*?)&lt;/p&gt;&#x27;</span>, re.S)<br></code></pre></td></tr></table></figure><h2 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    baseurl = <span class="hljs-string">&quot;https://movie.douban.com/top250?start=&quot;</span>  <span class="hljs-comment"># è¦çˆ¬å–çš„ç½‘é¡µé“¾æ¥</span><br>    <span class="hljs-comment"># 1.çˆ¬å–ç½‘é¡µ</span><br>    datalist = getData(baseurl)<br>    savepath = <span class="hljs-string">&quot;doubanTop250.xls&quot;</span>    <span class="hljs-comment"># å½“å‰ç›®å½•æ–°å»ºXLSï¼Œå­˜å‚¨è¿›å»</span><br>    <span class="hljs-comment"># dbpath = &quot;movie.db&quot;              # å½“å‰ç›®å½•æ–°å»ºæ•°æ®åº“ï¼Œå­˜å‚¨è¿›å»</span><br>    <span class="hljs-comment"># 3.ä¿å­˜æ•°æ®</span><br>    <span class="hljs-keyword">if</span> datalist:  <span class="hljs-comment"># åªæœ‰å½“æ•°æ®å­˜åœ¨æ—¶æ‰ä¿å­˜</span><br>        saveData(datalist, savepath)      <span class="hljs-comment"># 2ç§å­˜å‚¨æ–¹å¼å¯ä»¥åªé€‰æ‹©ä¸€ç§</span><br>        <span class="hljs-comment"># saveData2DB(datalist,dbpath)</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çˆ¬å–å®Œæ¯•ï¼&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æœªè·å–åˆ°æœ‰æ•ˆæ•°æ®ï¼&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="ç½‘é¡µçˆ¬å–"><a href="#ç½‘é¡µçˆ¬å–" class="headerlink" title="ç½‘é¡µçˆ¬å–"></a>ç½‘é¡µçˆ¬å–</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params">baseurl</span>):<br>    datalist = []  <span class="hljs-comment"># ç”¨æ¥å­˜å‚¨çˆ¬å–çš„ç½‘é¡µä¿¡æ¯</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>):  <span class="hljs-comment"># è°ƒç”¨è·å–é¡µé¢ä¿¡æ¯çš„å‡½æ•°ï¼Œ10æ¬¡</span><br>        url = baseurl + <span class="hljs-built_in">str</span>(i * <span class="hljs-number">25</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ­£åœ¨çˆ¬å–ç¬¬<span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>é¡µï¼š<span class="hljs-subst">&#123;url&#125;</span>&quot;</span>)<br>        html = askURL(url)  <span class="hljs-comment"># ä¿å­˜è·å–åˆ°çš„ç½‘é¡µæºç </span><br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> html:  <span class="hljs-comment"># å¦‚æœè·å–ä¸åˆ°ç½‘é¡µå†…å®¹ï¼Œè·³è¿‡</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¬¬<span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>é¡µçˆ¬å–å¤±è´¥ï¼Œè·³è¿‡&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br>            <br>        <span class="hljs-comment"># 2.é€ä¸€è§£ææ•°æ®</span><br>        soup = BeautifulSoup(html, <span class="hljs-string">&quot;html.parser&quot;</span>)<br>        items = soup.find_all(<span class="hljs-string">&#x27;div&#x27;</span>, class_=<span class="hljs-string">&quot;item&quot;</span>)  <span class="hljs-comment"># æŸ¥æ‰¾ç¬¦åˆè¦æ±‚çš„å­—ç¬¦ä¸²</span><br>        <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> items:  <span class="hljs-comment"># å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç”µå½±æ¡ç›®ï¼Œè·³è¿‡</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¬¬<span class="hljs-subst">&#123;i+<span class="hljs-number">1</span>&#125;</span>é¡µæ²¡æœ‰æ‰¾åˆ°ç”µå½±æ¡ç›®ï¼Œè·³è¿‡&quot;</span>)<br>            <span class="hljs-keyword">continue</span><br>            <br>        <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:<br>            data = []  <span class="hljs-comment"># ä¿å­˜ä¸€éƒ¨ç”µå½±æ‰€æœ‰ä¿¡æ¯</span><br>            item_str = <span class="hljs-built_in">str</span>(item)  <span class="hljs-comment"># é¿å…å˜é‡åå†²çª</span><br>            <br>            <span class="hljs-comment"># è§£æç”µå½±è¯¦æƒ…é“¾æ¥</span><br>            link_list = re.findall(findLink, item_str)<br>            link = link_list[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> link_list <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>            data.append(link)<br>            <br>            <span class="hljs-comment"># è§£æå›¾ç‰‡é“¾æ¥</span><br>            imgSrc_list = re.findall(findImgSrc, item_str)<br>            imgSrc = imgSrc_list[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> imgSrc_list <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>            data.append(imgSrc)<br>            <br>            <span class="hljs-comment"># è§£æå½±ç‰‡æ ‡é¢˜</span><br>            titles = re.findall(findTitle, item_str)<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(titles) == <span class="hljs-number">2</span>:<br>                ctitle = titles[<span class="hljs-number">0</span>].strip()<br>                data.append(ctitle)<br>                otitle = titles[<span class="hljs-number">1</span>].replace(<span class="hljs-string">&quot;/&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).strip()  <span class="hljs-comment"># æ¶ˆé™¤è½¬ä¹‰å­—ç¬¦</span><br>                data.append(otitle)<br>            <span class="hljs-keyword">elif</span> <span class="hljs-built_in">len</span>(titles) == <span class="hljs-number">1</span>:<br>                data.append(titles[<span class="hljs-number">0</span>].strip())<br>                data.append(<span class="hljs-string">&#x27; &#x27;</span>)<br>            <span class="hljs-keyword">else</span>:<br>                data.append(<span class="hljs-string">&#x27; &#x27;</span>)<br>                data.append(<span class="hljs-string">&#x27; &#x27;</span>)<br>            <br>            <span class="hljs-comment"># è§£æè¯„åˆ†</span><br>            rating_list = re.findall(findRating, item_str)<br>            rating = rating_list[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> rating_list <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;0&quot;</span><br>            data.append(rating)<br>            <br>            <span class="hljs-comment"># è§£æè¯„ä»·æ•°</span><br>            judgeNum_list = re.findall(findJudge, item_str)<br>            judgeNum = judgeNum_list[<span class="hljs-number">0</span>] <span class="hljs-keyword">if</span> judgeNum_list <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;0&quot;</span><br>            data.append(judgeNum)<br>            <br>            <span class="hljs-comment"># è§£ææ¦‚å†µ</span><br>            inq_list = re.findall(findInq, item_str)<br>            <span class="hljs-keyword">if</span> inq_list:<br>                inq = inq_list[<span class="hljs-number">0</span>].replace(<span class="hljs-string">&quot;ã€‚&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).strip()<br>                data.append(inq)<br>            <span class="hljs-keyword">else</span>:<br>                data.append(<span class="hljs-string">&quot; &quot;</span>)<br>            <br>            <span class="hljs-comment"># è§£æç›¸å…³ä¿¡æ¯ï¼ˆä¿®å¤è¿™é‡Œçš„IndexErrorï¼‰</span><br>            bd_list = re.findall(findBd, item_str)<br>            <span class="hljs-keyword">if</span> bd_list:<br>                bd = bd_list[<span class="hljs-number">0</span>]<br>                bd = re.sub(<span class="hljs-string">&#x27;&lt;br(\s+)?/&gt;(\s+)?&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>, bd)  <span class="hljs-comment"># å»é™¤bræ ‡ç­¾</span><br>                bd = re.sub(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&quot;&quot;</span>, bd)  <span class="hljs-comment"># å»é™¤/ç¬¦å·</span><br>                bd = re.sub(<span class="hljs-string">&#x27;\s+&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, bd)  <span class="hljs-comment"># å¤šä¸ªç©ºæ ¼æ›¿æ¢ä¸ºå•ä¸ªç©ºæ ¼</span><br>                data.append(bd.strip())<br>            <span class="hljs-keyword">else</span>:<br>                data.append(<span class="hljs-string">&quot; &quot;</span>)<br>            <br>            <span class="hljs-comment"># åªæœ‰å½“æ•°æ®å®Œæ•´æ—¶æ‰æ·»åŠ ï¼ˆè‡³å°‘æœ‰ä¸­æ–‡åå’Œè¯„åˆ†ï¼‰</span><br>            <span class="hljs-keyword">if</span> data[<span class="hljs-number">2</span>] <span class="hljs-keyword">and</span> data[<span class="hljs-number">4</span>] != <span class="hljs-string">&quot;0&quot;</span>:<br>                datalist.append(data)<br>    <br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å…±çˆ¬å–åˆ°<span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(datalist)&#125;</span>éƒ¨ç”µå½±æ•°æ®&quot;</span>)<br>    <span class="hljs-keyword">return</span> datalist<br></code></pre></td></tr></table></figure><h2 id="æ¨¡æ‹Ÿæµè§ˆå™¨å‘èµ·è¯·æ±‚"><a href="#æ¨¡æ‹Ÿæµè§ˆå™¨å‘èµ·è¯·æ±‚" class="headerlink" title="æ¨¡æ‹Ÿæµè§ˆå™¨å‘èµ·è¯·æ±‚"></a>æ¨¡æ‹Ÿæµè§ˆå™¨å‘èµ·è¯·æ±‚</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¾—åˆ°æŒ‡å®šä¸€ä¸ªURLçš„ç½‘é¡µå†…å®¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">askURL</span>(<span class="hljs-params">url</span>):<br>    head = &#123;  <span class="hljs-comment"># æ¨¡æ‹Ÿæµè§ˆå™¨å¤´éƒ¨ä¿¡æ¯ï¼Œå‘è±†ç“£æœåŠ¡å™¨å‘é€æ¶ˆæ¯</span><br>        <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36&quot;</span>,<br>        <span class="hljs-string">&quot;Accept&quot;</span>: <span class="hljs-string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span>,<br>        <span class="hljs-string">&quot;Accept-Language&quot;</span>: <span class="hljs-string">&quot;zh-CN,zh;q=0.9,en;q=0.8&quot;</span>,<br>        <span class="hljs-string">&quot;Referer&quot;</span>: <span class="hljs-string">&quot;https://movie.douban.com/&quot;</span><br>    &#125;<br>    <span class="hljs-comment"># ç”¨æˆ·ä»£ç†ï¼Œè¡¨ç¤ºå‘Šè¯‰è±†ç“£æœåŠ¡å™¨ï¼Œæˆ‘ä»¬æ˜¯ä»€ä¹ˆç±»å‹çš„æœºå™¨ã€æµè§ˆå™¨</span><br><br>    request = urllib.request.Request(url, headers=head)<br>    html = <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-keyword">try</span>:<br>        response = urllib.request.urlopen(request, timeout=<span class="hljs-number">30</span>)  <span class="hljs-comment"># æ·»åŠ è¶…æ—¶è®¾ç½®</span><br>        html = response.read().decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    <span class="hljs-keyword">except</span> urllib.error.URLError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(e, <span class="hljs-string">&quot;code&quot;</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;HTTPé”™è¯¯ä»£ç ï¼š<span class="hljs-subst">&#123;e.code&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(e, <span class="hljs-string">&quot;reason&quot;</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é”™è¯¯åŸå› ï¼š<span class="hljs-subst">&#123;e.reason&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è·å–ç½‘é¡µå†…å®¹æ—¶å‘ç”Ÿé”™è¯¯ï¼š<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">return</span> html<br><br></code></pre></td></tr></table></figure><h2 id="ä¿å­˜æ•°æ®"><a href="#ä¿å­˜æ•°æ®" class="headerlink" title="ä¿å­˜æ•°æ®"></a>ä¿å­˜æ•°æ®</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">saveData</span>(<span class="hljs-params">datalist, savepath</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ­£åœ¨ä¿å­˜æ•°æ®...&quot;</span>)<br>    <span class="hljs-keyword">try</span>:<br>        book = xlwt.Workbook(encoding=<span class="hljs-string">&quot;utf-8&quot;</span>, style_compression=<span class="hljs-number">0</span>)  <span class="hljs-comment"># åˆ›å»ºworkbookå¯¹è±¡</span><br>        sheet = book.add_sheet(<span class="hljs-string">&#x27;è±†ç“£ç”µå½±Top250&#x27;</span>, cell_overwrite_ok=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># åˆ›å»ºå·¥ä½œè¡¨</span><br>        col = (<span class="hljs-string">&quot;ç”µå½±è¯¦æƒ…é“¾æ¥&quot;</span>, <span class="hljs-string">&quot;å›¾ç‰‡é“¾æ¥&quot;</span>, <span class="hljs-string">&quot;å½±ç‰‡ä¸­æ–‡å&quot;</span>, <span class="hljs-string">&quot;å½±ç‰‡å¤–å›½å&quot;</span>, <span class="hljs-string">&quot;è¯„åˆ†&quot;</span>, <span class="hljs-string">&quot;è¯„ä»·æ•°&quot;</span>, <span class="hljs-string">&quot;æ¦‚å†µ&quot;</span>, <span class="hljs-string">&quot;ç›¸å…³ä¿¡æ¯&quot;</span>)<br>        <br>        <span class="hljs-comment"># å†™å…¥åˆ—å</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>):<br>            sheet.write(<span class="hljs-number">0</span>, i, col[i])<br>        <br>        <span class="hljs-comment"># å†™å…¥æ•°æ®</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(datalist)):<br>            data = datalist[i]<br>            <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>):<br>                <span class="hljs-comment"># ç¡®ä¿æ•°æ®ä¸ä¼šè¶…å‡ºå•å…ƒæ ¼é™åˆ¶</span><br>                <span class="hljs-keyword">if</span> j &lt; <span class="hljs-built_in">len</span>(data):<br>                    sheet.write(i + <span class="hljs-number">1</span>, j, data[j][:<span class="hljs-number">32767</span>] <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(data[j], <span class="hljs-built_in">str</span>) <span class="hljs-keyword">else</span> data[j])  <span class="hljs-comment"># é™åˆ¶å­—ç¬¦ä¸²é•¿åº¦</span><br>                <span class="hljs-keyword">else</span>:<br>                    sheet.write(i + <span class="hljs-number">1</span>, j, <span class="hljs-string">&quot;&quot;</span>)<br>        <br>        book.save(savepath)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ•°æ®å·²æˆåŠŸä¿å­˜åˆ°ï¼š<span class="hljs-subst">&#123;savepath&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ä¿å­˜æ•°æ®æ—¶å‘ç”Ÿé”™è¯¯ï¼š<span class="hljs-subst">&#123;<span class="hljs-built_in">str</span>(e)&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="æ–‡æ¡£åœ¨çº¿é¢„è§ˆå·¥å…·ï¼ˆæœ‰ç‚¹é—®é¢˜ï¼Œæ— æ³•è°ƒå–æœ¬åœ°æ–‡ä»¶èµ„æºï¼Œåç»­ä¿®æ”¹ï¼‰"><a href="#æ–‡æ¡£åœ¨çº¿é¢„è§ˆå·¥å…·ï¼ˆæœ‰ç‚¹é—®é¢˜ï¼Œæ— æ³•è°ƒå–æœ¬åœ°æ–‡ä»¶èµ„æºï¼Œåç»­ä¿®æ”¹ï¼‰" class="headerlink" title="æ–‡æ¡£åœ¨çº¿é¢„è§ˆå·¥å…·ï¼ˆæœ‰ç‚¹é—®é¢˜ï¼Œæ— æ³•è°ƒå–æœ¬åœ°æ–‡ä»¶èµ„æºï¼Œåç»­ä¿®æ”¹ï¼‰"></a>æ–‡æ¡£åœ¨çº¿é¢„è§ˆå·¥å…·ï¼ˆæœ‰ç‚¹é—®é¢˜ï¼Œæ— æ³•è°ƒå–æœ¬åœ°æ–‡ä»¶èµ„æºï¼Œåç»­ä¿®æ”¹ï¼‰</h2><h1 id="2-åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œç”Ÿæˆå¯¹æŠ—æ ·ä¾‹ç”Ÿæˆ"><a href="#2-åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œç”Ÿæˆå¯¹æŠ—æ ·ä¾‹ç”Ÿæˆ" class="headerlink" title="2.åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œç”Ÿæˆå¯¹æŠ—æ ·ä¾‹ç”Ÿæˆ"></a>2.åˆ©ç”¨å¤§æ¨¡å‹è¿›è¡Œç”Ÿæˆå¯¹æŠ—æ ·ä¾‹ç”Ÿæˆ</h1><blockquote><p>æ•´ä½“æ€è·¯å¦‚ä¸‹ï¼š</p><p>1.çˆ¬è™«è·å–æ•°æ®æ¨¡æ‹Ÿå¾—åˆ°çš„æ•°æ®</p><p>2.é¦–å…ˆåˆ©ç”¨ç”Ÿæˆå™¨å¯¹XLSä¸­ç‰¹å®šé¢†åŸŸè¿›è¡Œåˆ†æ</p><p>2.å¬å›ç‡æ€ä¹ˆå®ç°å‘¢ï¼Ÿå¼•å…¥ç¬¬3ä¸ªå¤§æ¨¡å‹å¯¹ä¸¤ä¸ªæ¨¡å‹çš„æç¤ºè¯åŠæœ€ç»ˆç­”æ¡ˆè¿›è¡Œè¯„åˆ†ï¼Ÿ</p><p>3.å°†è¯„åˆ†é«˜çš„é—®é¢˜è¾“å‡º</p></blockquote><p>æ¨¡å‹å¦‚ä¸‹ï¼š</p><p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/dify.png" alt="dify"></p><p>ç€é‡å¯¹å›ç­”ï¼š</p><p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/Q.png" alt="Q"></p><p>å¯¹ä¸¤è€…å›ç­”ï¼š</p><p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/2.png" alt="2"></p><h1 id="3-æ¥å£è°ƒç”¨difyï¼Œæœ¬åœ°æ¨¡æ‹Ÿè°ƒç”¨"><a href="#3-æ¥å£è°ƒç”¨difyï¼Œæœ¬åœ°æ¨¡æ‹Ÿè°ƒç”¨" class="headerlink" title="3.æ¥å£è°ƒç”¨difyï¼Œæœ¬åœ°æ¨¡æ‹Ÿè°ƒç”¨"></a>3.æ¥å£è°ƒç”¨difyï¼Œæœ¬åœ°æ¨¡æ‹Ÿè°ƒç”¨</h1><h2 id="3-1-å·¥ä½œæµè°ƒç”¨"><a href="#3-1-å·¥ä½œæµè°ƒç”¨" class="headerlink" title="3.1 å·¥ä½œæµè°ƒç”¨"></a>3.1 å·¥ä½œæµè°ƒç”¨</h2><p>1.æ ¹æ®æ¥å£æ–‡ä»¶å®Œæˆæœ¬åœ°æ¨¡æ‹Ÿè°ƒç”¨ï¼Œè°ƒç”¨ä»£ç å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><br>url = <span class="hljs-string">&quot;https://api.dify.ai/v1/chat-messages&quot;</span>   <span class="hljs-comment"># è¦è¡¥å……chat-messages ä¸èƒ½ç›´æ¥v1</span><br>headers = &#123;<br>    <span class="hljs-string">&quot;Authorization&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>&#125;<br><br>content_input = <span class="hljs-string">&quot;1+1ç­‰äºå‡ &quot;</span><br>payload = &#123;<br>    <span class="hljs-string">&quot;inputs&quot;</span>: &#123;<span class="hljs-string">&quot;Content_input&quot;</span>: content_input&#125;,<br>    <span class="hljs-string">&quot;query&quot;</span>: content_input,    <span class="hljs-comment"># queryä¸inputä¿æŒä¸€è‡´</span><br>    <span class="hljs-string">&quot;response_mode&quot;</span>: <span class="hljs-string">&quot;blocking&quot;</span>,  <span class="hljs-comment"># åŒæ­¥æ¨¡å¼</span><br>    <span class="hljs-string">&quot;conversation_id&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;abc-123&quot;</span>    <span class="hljs-comment"># ç”¨æˆ·æ ‡è¯†ç¬¦ï¼Œæ„Ÿè§‰æ²¡ä»€ä¹ˆæ„ä¹‰</span><br>&#125;<br><br><span class="hljs-keyword">try</span>:<br>    workflow_response = requests.post(<br>        url,<br>        json=payload,  <span class="hljs-comment"># ç®€åŒ–ï¼šç›´æ¥ä¼ jsonï¼Œæ— éœ€æ‰‹åŠ¨dumps</span><br>        headers=headers,<br>        timeout=<span class="hljs-number">30</span><br>    )<br>    workflow_response.raise_for_status()<br>    result = workflow_response.json()<br>    <br>    <span class="hljs-comment"># åŒæ­¥æ¨¡å¼ç›´æ¥æå–answer</span><br>    full_answer = result.get(<span class="hljs-string">&quot;answer&quot;</span>, <span class="hljs-string">&quot;æœªè·å–åˆ°å›ç­”&quot;</span>)  <span class="hljs-comment"># æ„Ÿè§‰è¿™ä¸ªæ ¼å¼æ˜¯å¯¹çš„ï¼Œæ¥å£è°ƒç”¨å¯èƒ½æœ‰é—®é¢˜</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŒæ­¥å“åº”ç»“æœï¼š&quot;</span>, full_answer)<br>    <span class="hljs-comment"># æ‰“å°å®Œæ•´å“åº”ï¼ˆä¾¿äºè°ƒè¯•ï¼‰</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å®Œæ•´å“åº”ç»“æ„ï¼š&quot;</span>, json.dumps(result, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br>    <br><span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;è¯·æ±‚å¤±è´¥ï¼š<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(e, <span class="hljs-string">&#x27;response&#x27;</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é”™è¯¯è¯¦æƒ…ï¼š<span class="hljs-subst">&#123;e.response.text&#125;</span>&quot;</span>)<br><span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;JSONè§£æå¤±è´¥ï¼š<span class="hljs-subst">&#123;e&#125;</span> | å“åº”å†…å®¹ï¼š<span class="hljs-subst">&#123;workflow_response.text&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/dify_api.png" alt="difyApi"></p><h2 id="3-2-æ–‡ä»¶ä¸Šä¼ "><a href="#3-2-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="3.2 æ–‡ä»¶ä¸Šä¼ "></a>3.2 æ–‡ä»¶ä¸Šä¼ </h2><p>ä»£ç å¦‚ä¸‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-comment"># ======================== æ ¸å¿ƒé…ç½®ï¼ˆç»Ÿä¸€é…ç½®ï¼Œé¿å…å¤šå¤„ç¡¬ç¼–ç ï¼‰ ========================</span><br>API_KEY = <span class="hljs-string">&quot;&quot;</span>  <span class="hljs-comment"># ç»Ÿä¸€ä½¿ç”¨æ­£ç¡®çš„API Key</span><br>BASE_URL = <span class="hljs-string">&quot;https://api.dify.ai&quot;</span><br>FILE_PATH = <span class="hljs-string">&quot;doubanTop250.xls&quot;</span>  <span class="hljs-comment"># æ›¿æ¢ä¸ºå®é™…æ–‡ä»¶è·¯å¾„</span><br>QUERY = <span class="hljs-string">&quot;è¯·åˆ†æè¿™ä¸ªExcelæ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œæ€»ç»“æ ¸å¿ƒä¿¡æ¯&quot;</span><br>USER_ID = <span class="hljs-string">&quot;abc-123&quot;</span><br><br><span class="hljs-comment"># æ–‡æ¡£ç±»å‹æ˜ å°„ï¼ˆDifyè§„èŒƒï¼‰</span><br>SUPPORTED_FILE_TYPES = &#123;<br>    <span class="hljs-string">&#x27;document&#x27;</span>: [<span class="hljs-string">&#x27;.txt&#x27;</span>, <span class="hljs-string">&#x27;.md&#x27;</span>, <span class="hljs-string">&#x27;.pdf&#x27;</span>, <span class="hljs-string">&#x27;.html&#x27;</span>, <span class="hljs-string">&#x27;.xlsx&#x27;</span>, <span class="hljs-string">&#x27;.xls&#x27;</span>, <span class="hljs-string">&#x27;.csv&#x27;</span>, <span class="hljs-string">&#x27;.doc&#x27;</span>, <span class="hljs-string">&#x27;.docx&#x27;</span>, <span class="hljs-string">&#x27;.pptx&#x27;</span>, <span class="hljs-string">&#x27;.ppt&#x27;</span>],<br>    <span class="hljs-string">&#x27;image&#x27;</span>: [<span class="hljs-string">&#x27;.jpg&#x27;</span>, <span class="hljs-string">&#x27;.jpeg&#x27;</span>, <span class="hljs-string">&#x27;.png&#x27;</span>, <span class="hljs-string">&#x27;.gif&#x27;</span>, <span class="hljs-string">&#x27;.webp&#x27;</span>, <span class="hljs-string">&#x27;.svg&#x27;</span>],<br>    <span class="hljs-string">&#x27;audio&#x27;</span>: [<span class="hljs-string">&#x27;.mp3&#x27;</span>, <span class="hljs-string">&#x27;.m4a&#x27;</span>, <span class="hljs-string">&#x27;.wav&#x27;</span>, <span class="hljs-string">&#x27;.webm&#x27;</span>],<br>    <span class="hljs-string">&#x27;video&#x27;</span>: [<span class="hljs-string">&#x27;.mp4&#x27;</span>, <span class="hljs-string">&#x27;.mov&#x27;</span>, <span class="hljs-string">&#x27;.mpeg&#x27;</span>],<br>    <span class="hljs-string">&#x27;custom&#x27;</span>: []<br>&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_file_type_and_mime</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;è·å–æ–‡ä»¶çš„Difyç±»å‹å’ŒMIMEç±»å‹&quot;&quot;&quot;</span><br>    ext = os.path.splitext(file_path)[<span class="hljs-number">1</span>].lower()<br>    <br>    <span class="hljs-comment"># åŒ¹é…Difyçš„file_type</span><br>    file_type = <span class="hljs-string">&#x27;custom&#x27;</span><br>    <span class="hljs-keyword">for</span> typ, exts <span class="hljs-keyword">in</span> SUPPORTED_FILE_TYPES.items():<br>        <span class="hljs-keyword">if</span> ext <span class="hljs-keyword">in</span> exts:<br>            file_type = typ<br>            <span class="hljs-keyword">break</span><br>    <br>    <span class="hljs-comment"># åŒ¹é…MIMEç±»å‹</span><br>    mime_map = &#123;<br>        <span class="hljs-string">&#x27;.xls&#x27;</span>: <span class="hljs-string">&#x27;application/vnd.ms-excel&#x27;</span>,<br>        <span class="hljs-string">&#x27;.xlsx&#x27;</span>: <span class="hljs-string">&#x27;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&#x27;</span>,<br>        <span class="hljs-string">&#x27;.csv&#x27;</span>: <span class="hljs-string">&#x27;text/csv&#x27;</span>,<br>        <span class="hljs-string">&#x27;.txt&#x27;</span>: <span class="hljs-string">&#x27;text/plain&#x27;</span>,<br>        <span class="hljs-string">&#x27;.pdf&#x27;</span>: <span class="hljs-string">&#x27;application/pdf&#x27;</span>,<br>        <span class="hljs-string">&#x27;.jpg&#x27;</span>: <span class="hljs-string">&#x27;image/jpeg&#x27;</span>,<br>        <span class="hljs-string">&#x27;.png&#x27;</span>: <span class="hljs-string">&#x27;image/png&#x27;</span>,<br>        <span class="hljs-string">&#x27;.mp3&#x27;</span>: <span class="hljs-string">&#x27;audio/mpeg&#x27;</span>,<br>        <span class="hljs-string">&#x27;.mp4&#x27;</span>: <span class="hljs-string">&#x27;video/mp4&#x27;</span><br>    &#125;<br>    mime_type = mime_map.get(ext, <span class="hljs-string">&#x27;application/octet-stream&#x27;</span>)<br>    <span class="hljs-keyword">return</span> file_type, mime_type<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file_path, api_key</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;ä¸Šä¼ æ–‡ä»¶åˆ°Difyï¼Œè¿”å›upload_file_id&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(file_path):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ æ–‡ä»¶ä¸å­˜åœ¨: <span class="hljs-subst">&#123;file_path&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>    <br>    upload_url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;BASE_URL&#125;</span>/v1/files/upload&quot;</span><br>    file_type, mime_type = get_file_type_and_mime(file_path)<br>    file_name = os.path.basename(file_path)<br>    <br>    headers = &#123;<span class="hljs-string">&#x27;Authorization&#x27;</span>: <span class="hljs-string">f&#x27;Bearer <span class="hljs-subst">&#123;api_key&#125;</span>&#x27;</span>&#125;<br>    <br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&#x27;rb&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            files = &#123;<span class="hljs-string">&#x27;file&#x27;</span>: (file_name, f, mime_type)&#125;<br>            response = requests.post(<br>                upload_url,<br>                headers=headers,<br>                files=files,<br>                timeout=<span class="hljs-number">60</span><br>            )<br>        response.raise_for_status()<br>        <br>        upload_file_id = response.json().get(<span class="hljs-string">&#x27;id&#x27;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âœ… æ–‡ä»¶ä¸Šä¼ æˆåŠŸ&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - æ–‡ä»¶ç±»å‹: <span class="hljs-subst">&#123;file_type&#125;</span>&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   - Upload File ID: <span class="hljs-subst">&#123;upload_file_id&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> upload_file_id<br>    <br>    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(e, <span class="hljs-string">&#x27;response&#x27;</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   é”™è¯¯è¯¦æƒ…ï¼š<span class="hljs-subst">&#123;e.response.text&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><span class="hljs-comment"># ======================== ä¸»æ‰§è¡Œé€»è¾‘ ========================</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    <span class="hljs-comment"># 1. ä¸Šä¼ æ–‡ä»¶</span><br>    upload_file_id = upload_file(FILE_PATH, API_KEY)<br>    <br>    <span class="hljs-comment"># æ£€æŸ¥æ–‡ä»¶ä¸Šä¼ æ˜¯å¦æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> upload_file_id:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;âŒ æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œç»ˆæ­¢æ‰§è¡Œ&quot;</span>)<br>        exit(<span class="hljs-number">1</span>)<br>    <br>    <span class="hljs-comment"># 2. æ„å»ºè¯·æ±‚å‚æ•°ï¼ˆä¿®å¤æ–‡ä»¶å‚æ•°æ ¼å¼ï¼‰</span><br>    payload = &#123;<br>        <span class="hljs-string">&quot;inputs&quot;</span>: &#123;<span class="hljs-string">&quot;Content_input&quot;</span>: QUERY&#125;,<br>        <span class="hljs-string">&quot;query&quot;</span>: QUERY,<br>        <span class="hljs-string">&quot;response_mode&quot;</span>: <span class="hljs-string">&quot;blocking&quot;</span>,<br>        <span class="hljs-string">&quot;conversation_id&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>        <span class="hljs-string">&quot;user&quot;</span>: USER_ID,<br>        <span class="hljs-string">&quot;files&quot;</span>: [<br>            &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,  <span class="hljs-comment"># å¿…é¡»åŒ¹é…Difyçš„file_typeï¼ˆä¸æ˜¯æ–‡ä»¶åç¼€ï¼‰</span><br>                <span class="hljs-string">&quot;upload_file_id&quot;</span>: upload_file_id  <span class="hljs-comment"># ç§»é™¤é”™è¯¯çš„transfer_methodå­—æ®µ</span><br>            &#125;<br>        ]<br>    &#125;<br><br>    <span class="hljs-comment"># 3. å‘é€èŠå¤©è¯·æ±‚ï¼ˆç»Ÿä¸€API Keyï¼Œå®Œå–„å¼‚å¸¸å¤„ç†ï¼‰</span><br>    chat_url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;BASE_URL&#125;</span>/v1/chat-messages&quot;</span><br>    headers = &#123;<br>        <span class="hljs-string">&quot;Authorization&quot;</span>: <span class="hljs-string">f&quot;Bearer <span class="hljs-subst">&#123;API_KEY&#125;</span>&quot;</span>,  <span class="hljs-comment"># ç»Ÿä¸€ä½¿ç”¨é…ç½®ä¸­çš„API Key</span><br>        <span class="hljs-string">&quot;Content-Type&quot;</span>: <span class="hljs-string">&quot;application/json&quot;</span>,<br>    &#125;<br>    <br>    <span class="hljs-keyword">try</span>:<br>        workflow_response = requests.post(<br>            chat_url,<br>            json=payload,<br>            headers=headers,<br>            timeout=<span class="hljs-number">120</span>  <span class="hljs-comment"># åˆ†æExceléœ€è¦æ›´é•¿è¶…æ—¶æ—¶é—´</span><br>        )<br>        workflow_response.raise_for_status()<br>        result = workflow_response.json()<br>        <br>        <span class="hljs-comment"># æå–ç»“æœ</span><br>        full_answer = result.get(<span class="hljs-string">&quot;answer&quot;</span>, <span class="hljs-string">&quot;æœªè·å–åˆ°å›ç­”&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nâœ… åŒæ­¥å“åº”ç»“æœï¼š&quot;</span>, full_answer)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nğŸ“‹ å®Œæ•´å“åº”ç»“æ„ï¼š&quot;</span>, json.dumps(result, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>))<br>        <br>    <span class="hljs-keyword">except</span> requests.exceptions.HTTPError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nâŒ HTTPè¯·æ±‚é”™è¯¯ï¼š<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(e, <span class="hljs-string">&#x27;response&#x27;</span>):<br>            <span class="hljs-comment"># æ‰“å°Difyè¿”å›çš„å…·ä½“é”™è¯¯ä¿¡æ¯</span><br>            error_detail = e.response.text<br>            <span class="hljs-keyword">try</span>:<br>                error_json = json.loads(error_detail)<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   é”™è¯¯è¯¦æƒ…ï¼š<span class="hljs-subst">&#123;json.dumps(error_json, ensure_ascii=<span class="hljs-literal">False</span>, indent=<span class="hljs-number">2</span>)&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">except</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;   é”™è¯¯è¯¦æƒ…ï¼š<span class="hljs-subst">&#123;error_detail&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">except</span> requests.exceptions.Timeout:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nâŒ è¯·æ±‚è¶…æ—¶ï¼ˆExcelåˆ†æå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ï¼‰&quot;</span>)<br>    <span class="hljs-keyword">except</span> requests.exceptions.ConnectionError:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;\nâŒ ç½‘ç»œè¿æ¥é”™è¯¯ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ&quot;</span>)<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\nâŒ æœªçŸ¥é”™è¯¯ï¼š<span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¸»è¦éš¾ç‚¹åœ¨äºæ¥å£è°ƒç”¨ä¸€ç›´æœ‰é—®é¢˜ï¼Œï¼ˆä¸Šä¼ æ–‡ä»¶æ²¡é—®é¢˜ï¼Œåœ¨å¹³å°è¿è¡Œä¹Ÿæ²¡é—®é¢˜ï¼Œå°±æ˜¯ä»ç½‘ç«™getå›ç­”ä¸€ç›´æœ‰é—®é¢˜ï¼‰åç»­åˆ©ç”¨å¤§æ¨¡å‹å®ç°ä»£ç ä¿®æ”¹ï¼Œä½†åç»­ä»£ç ä»ç„¶éœ€è¦ç®€åŒ–ã€‚</p><p>æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤º,æ‰€ç”¨å¤§æ¨¡å‹ä¸º2ä¸­æåˆ°çš„å¤§æ¨¡å‹</p><p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/file_upload.png" alt="upload_file"></p><h1 id="4-ç½‘ç»œçŠ¶æ€"><a href="#4-ç½‘ç»œçŠ¶æ€" class="headerlink" title="4.ç½‘ç»œçŠ¶æ€"></a>4.ç½‘ç»œçŠ¶æ€</h1><p>100-200 æ¶ˆæ¯å“åº”</p><p>200-300 çŠ¶æ€æ­£å¸¸</p><p>300-400 èµ„æºé‡å®šå‘</p><p>400-500 å®¢æˆ·ç«¯é”™è¯¯</p><p>500-600 æœåŠ¡ç«¯é”™è¯¯</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ—¥æŠ¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>12æœˆ12æ—¥æŠ¥</title>
    <link href="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/"/>
    <url>/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/</url>
    
    <content type="html"><![CDATA[<p>1.å®ŒæˆæŠ€æœ¯åšå®¢çš„æ­å»ºï¼Œå¦‚ä¸‹æ‰€ç¤º</p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/blog.png" class="" title="åšå®¢æ¼”ç¤ºå›¾"><p>ä¸»è¦éš¾ç‚¹å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰åœ¨ç•Œé¢æ˜¾ç¤ºè®¿é—®é‡æœªå®ç°</p><p>ï¼ˆ2ï¼‰æ¸²æŸ“é—®é¢˜ï¼ˆåç»­è§£å†³ï¼Œå®é™…ä¸Šæ˜¯æµè§ˆå™¨ç¼“å­˜å¯¼è‡´çš„ï¼‰</p><p>2.å¤§æ¨¡å‹ï¼ˆé™„long-chainï¼‰</p><p>MCPï¼ˆå¤§æ¨¡å‹ä¸Šä¸‹æ–‡åè®® - å·¥å…·è£…çš„ç»Ÿä¸€æ¥å£ï¼‰</p><p>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰-&gt; å‘é‡ç›¸ä¼¼åº¦æ£€ç´¢ -&gt; LLMå¤§æ¨¡å‹ &#x3D;&gt; dify , Fastgptâ€¦</p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/RAG.png" class="" title="RAGæ¼”ç¤ºå›¾"><p>Langchainï¼šè¾ƒä¸ºçµæ´»çš„å¤§æ¨¡å‹å·¥å…·ï¼ˆæ¯”ä¹‹difyï¼Ÿä½†æ˜¯ç”¨èµ·æ¥ä¸å¤Ÿç®€åŒ–ï¼‰</p><img src="/2025/12/12/12%E5%8F%B7%E6%B5%8B%E8%AF%95%E6%96%87%E7%AB%A0/blog.png" class="" title="åšå®¢æ¼”ç¤ºå›¾">]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ—¥æŠ¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
